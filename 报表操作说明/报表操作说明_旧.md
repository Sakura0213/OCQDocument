# 报表操作演示指南

> 讲解视频：暂无



## 一、进入报表编辑页面

**操作演示:**

<img src="https://files.catbox.moe/lxgadr.png" alt="1684238801348" style="zoom:67%;" />

**详细步骤：**

1. 在 OCQ 任意界面的右上角找到 **设置图标** 并点击
2. 点击设置左下角的 **高级设置**
3. 点击 **模块管理** 中的模块
4. 在模块编辑页面中，找到 **布局设计器** 并点击
5. 点击布局设计器左下角的 **报表** 布局后，选择一个布局并点击 **编辑** 即可进入报表页面（若没有存在的报表布局，则需要新建一个报表布局）



## 二、新建报表布局

**操作演示:** 

<img src="https://files.catbox.moe/sqnjmq.png" alt="1684241986492" style="zoom: 50%;" />

**详细步骤：**

1. 在布局设计器中点击 **报表布局** 
2. 在右下角点击 **添加布局** 去新建一个报表布局
3. 在配置完报表的基本参数后，点击 **确定** 即可新建一个报表并跳转到该报表的编辑页面（参数信息如下）
   1. 布局类型：因为我们需要的是报表，所以在下拉框中选择 **报表布局**
   2. 主数据源：选择任意数据源当作入口（即在该模块中的布局设计器里，可以看见该布局）
   3. 布局名称：即布局设计器中显示的布局名称（建议命名为 **英文**）
   4. 布局备注：填写布局的相关备注，可不填
   5. 布局图标：选择一个图标即可，可不选





## 三、设置数据筛选控件

> <font color='red'>**数据筛选的作用是**</font>：对配置了 **日期筛选** 的 **数据源** 中的数据进行最初的筛选（在接下来演示的效果为：将数据按月份进行分类，选到哪年的哪一个月份，则报表中的数据都是对于这个月份来做统计的）



#### 1.设置时间筛选控件 

**操作演示：**

![1](https://files.catbox.moe/wfw1ju.png)

**详细步骤：**

1. 在常用控件中选择一个 **日期时间** 控件
2. 名称选择一个为日期格式的字段（当然也可以设置为你要的核准日期，同理）
3. 将该控件属性中的 **PDF查询组件** 勾选上（作用为在预览打印页面 **最上方** 固定该控件）
4. 将时间控件字段属性中的 **日期格式** 设置为 **年-月**



#### 2.将数据源与该时间筛选控件进行绑定 

**操作演示：**

<img src="https://files.catbox.moe/scdq2y.png" alt="1684259397665" style="zoom: 80%;" />

**详细步骤:**

1. 编辑要设置的数据源，点击 **筛选条件** ，点击 **全部匹配** ，点击 **新增一项** 

2. 在第一个列表中选择要被筛选的日期字段，被筛选的日期可以不是时间控件的字段，在这里只作为时间控件的绑定（如客户表中没有开店日期这个字段，但可以将客户的核准日期绑定该开店日期）

3. 在第二个列表中选择 **区间**

4. 点击第三个文本框右方的公式编辑按钮 **Fx**，点 **编辑**，填入 **csb({c_kaidianriqi}, '-01')** 后保存。若配置了时间控件，则在该公式编辑的界面的左下角会出现 **时间戳**，点击时间戳可拿到该时间控件的 **字段名** ，这里为c__kaidianriqi

   <img src="https://files.catbox.moe/qw68cq.png" alt="1684288043932" style="zoom: 67%;" />

5. 第四个文本框同理，填入的是 **csb({c__kaidianriqi}, '-31')**  （注意：区间的第二个参数中，配置公式的第二个参数为 <font color='red'>**'-31'**</font>）

6. 添加完筛选条件后点击最底下的 **确定** 进行保存



#### 3.效果

1. 配置了一个日期时间控件 **开店日期**

2. 放了一个表格，将数据源 **门店** 中的开店日期绑定该时间控件

3. 效果就在 **预览打印页面** 中，对月份进行选择后点击 **预览**，那么绑定了该控件的数据源会进行最初的筛选，筛选出该月份的数据

   <img src="https://files.catbox.moe/k5jsmk.png" alt="1684287605702" style="zoom: 50%;" />





## 四、markdown控件



### (一)在md控件中显示字典的值

#### 1.新建一个新建一个字典

**操作演示：**

<img src="https://files.catbox.moe/jn5cp4.png" alt="1684246252296"  />

**详细步骤：**

1. 首先要明确字典的使用是按照：由字典类型中的字典键，取到字典值
2. 首先在高级设置中点击 **字典配置**
3. 点击 **添加字典类型**，在添加字典的类型和说明后点击保存，即可添加 **字典类型**
4. 在字典页面中选择一个字典类型后，点击 **添加字典信息**
5. 在配置完字典的参数后点击保存，即可添加 **字典键与值**
6. 例：此时已经新建了一个字典，类型Code为 **SYSTEM **，字典Code为 **hello** ，字典的值为 **你好**



#### 2.在markdown控件中显示字典的值

**操作演示：**

<img src="https://files.catbox.moe/vdilxs.png" alt="1684248149105" style="zoom: 80%;" />

**详细步骤：**

1. 在报表编辑页面左上方点击 **控件图标**
2. 在高级控件中找到 **markdown控件**，点击或拖动该控件都可
3. 在布局设计中点击该控件，可以在右方看见该控件的配置属性
4. 点击内容的 **编辑** 即可跳转到markdown文档的编辑页面
5. 输入获取字典值的公式 **{{getDictValue('SYSTEM', 'hello')}}**
   1. 该公式的作用是：通过字典类型的字典键，取到字典的值
   2. 第一个参数：字典类型
   3. 第二个参数：字典的键
6. 点击保存后，页面右上角点击 **预览** 即可显示出效果（保存后在编辑页面不会进行公式与值的替换，需要点击预览，页面经过渲染后才可以看到效果）



#### 3.效果

公式被 **SYSTEM** 类型的 **hello** 字典的值 **你好** 替换

<img src="https://files.catbox.moe/mamnqx.png" alt="1684289358225" style="zoom: 67%;" />





### (二)在md控件中显示数据的汇总

**操作页面：**

![1684292269866](https://files.catbox.moe/ratejk.png)

**详细步骤：**

1. 进入markdown控件的编辑界面

2. 使用 **{{sumData(ds-ezcfz.data, 'c__huobizijin', 2, true)}}** 公式

   1. 该公式的作用是：将数据进行相加，相加的是 ds-ezcfz 这张表的 c_huobizijin 这个字段
   2. 第一个参数：数据源，也就是表，使用时要在表后面加上 “**.data**” 代指拿到这张表的数据
   3. 第二个参数：表中的字段
   4. 第三个参数：为小数位，这里参数 2 指的是md控件进行渲染后，相加后的数据会有两位小数位
   5. 第四个参数：为千位分隔符，true为使用千位分隔符，即数据在每三位会加一个逗号（100,000,000）

3. <font color='red'>**重要**</font> ：在md控件中 <font color='red'>**想拿到的数据源中的字段**</font>，那么这些字段都应该在数据源中<font color='red'>**被勾选**</font>，如下图，如果要在md控件中拿到c_huobizijin 这个字段，则要在编辑数据源的栏位中，将该字段进行勾选)

   (如果是接下来的 **图形控件** 要拿的数据，那么随意选择一个字段即可，不影响)

   <img src="https://files.catbox.moe/wisfbn.png" alt="1684256410702" style="zoom: 80%;" />

**效果：**

将公式 **{{sumData(ds-ezcfz.data, 'c__huobizijin', 2, true)}}** 替换为数据的总和

<img src="https://files.catbox.moe/0g99mu.png" alt="1684291999269" style="zoom: 80%;" />





### (三)在md控件中显示筛选后的数据的汇总

若该数据源配置了日期筛选后（如上方的核准日期这个日期控件），则会对数据源进行最初的筛选，那么使用拿到的数据都为该月份的数据，则sumData() 公式汇总的数据就为该月份的数据





## 五、图形控件

**将图形控件中的数据绑定核准日期**：

也就是通过核准日期对该数据源进行最初的筛选，那么表格中拿到的数据都为筛选后的数据（如需要则对数据源进行配置）



### (一)表格

**操作演示：**

<img src="https://files.catbox.moe/cpi1gv.png" alt="image-20230517112524460" style="zoom:67%;" />

**效果：**

<img src="https://files.catbox.moe/n0042r.png" alt="1684293632973" style="zoom:67%;" />

**详细步骤：**

1. 在控件中点击或拖动 **表格控件** 来新建一个表格控件
2. 在布局中点击该控件，在右上方的控件数据中编辑 **选择数据集**
3. 在配置数据集中，选择一个表（也就是配置好的 **实体类** 数据源）
4. 在选择列字段中，将要展示在表格中的字段进行编辑，即可





### (二)柱状图

**操作演示：**

<img src="https://files.catbox.moe/g2hg5b.png" alt="1684295133752" style="zoom:67%;" />

**效果：**

<img src="https://files.catbox.moe/foztm7.png" alt="image-20230517114458140" style="zoom: 67%;" />

**详细步骤：**

1. 在控件中点击或拖动 **柱状图控件** 来新建一个柱状图控件
2. 在布局中点击该控件，在右上方的控件数据中编辑 **选择数据集**
3. 在配置数据集中，选择一个表（也就是配置好的 **实体类** 数据源）
4. 分类依据指的是 **X轴由什么坐标来分类** （如上X轴的客家门店名称，若有多个分类依据，则在左上方会有切换分类的按钮）
5. 统计数据指的是 **Y轴统计的是表中的什么数据**（蓝色柱子为门店面积，绿色柱子为经营天数）





### (三)饼图

**操作演示：**

<img src="https://files.catbox.moe/htzs3a.png" alt="1684302922223" style="zoom:67%;" />

<img src="https://files.catbox.moe/7tjymr.png" alt="123" style="zoom: 50%;" />

**效果：**

<img src="https://files.catbox.moe/hr7jkp.png" alt="1684302998711" style="zoom: 50%;" />

**详细步骤：**

1. 在控件中点击或拖动 **饼图控件** 来新建一个饼图控件
2. 在布局中点击该控件，在右上方的控件数据中编辑 **选择数据集**
3. 在配置数据集中，选择一个表（也就是配置好的 **实体类** 数据源）
4. 分类依据指的是 **饼图各部分按什么来分类** （如上饼图中按门店名称分类，若有多个分类依据，则在左上方会有切换分类的按钮）
5. 统计数据指的是 **饼图中各部分所占的比例** （如上饼图统计的为经营的天数）
6. 新建好饼图后，如果发现饼图中统计的数据不够直观，则可以将 **表格与饼图放在一起**进行展示
   1. 在控件中找到 **栅格容器** 这个组件，在右方的 **布局** 中，选择将容器一分为二，左右各一半
   2. 新建一个与饼图数据 **对应** 的表格
   3. 最后拖动表格与饼图组件，将两个组件放到栅格容器中去





### (四)折线图

**操作演示：**

<img src="https://files.catbox.moe/eva56b.png" alt="1684304242839" style="zoom:67%;" />

**效果：**

<img src="https://files.catbox.moe/c3ecip.png" alt="image-20230517141814587" style="zoom: 67%;" />

**详细步骤：**

使用方法同柱状图控件





## 六、财务报表实现案例

<img src="https://files.catbox.moe/t338cb.png" alt="1684304876397" style="zoom:50%;" />

1. 核准日期：参考《三、设置核准日期》
2. 封面图片：封面图片其实是一个加大的 **栅格容器**，对栅格容器属性的背景图片进行上传即可





<img src="https://files.catbox.moe/vnml9p.png" alt="1684305246941" style="zoom:50%;" />

* 本质上封面、获取值的控件都在 **栅格容器** 中获取字典值的最上面有一个大的占位控件，为 **不显示标题的标签控件** ，意义为：将之后的md控件往下挪，挪到合适的


1. 获取字典值：其实是一个markdown控件，md控件控件中放入获取字典值的公式，并设值居中，获取字典值可参考《四、(一)在md控件中显示字典的值》
2. 因为 c__hezhunriqi 这个字段，为配置好的筛选日期字段，则在 **预览打印页面** 中，对日期进行筛选，这个字段的值也会随之改变，又由year()、month()公式，可得到改变字段的年与月
3. 目录标题：这标题实质为标签控件，对标题进行居中





<img src="https://files.catbox.moe/i9h5i0.png" alt="1684306293503" style="zoom:50%;" />

* 目录内容其实是markdown控件，在控件中对内容进行的编辑





<img src="https://files.catbox.moe/xf1dgv.png" alt="1684306434779" style="zoom:50%;" />

* 控件与控件之间的空白，实质为一个不显示标题的标签框，效果为对控件进行隔开，美观作用





<img src="https://files.catbox.moe/6csuko.png" alt="1684307487288" style="zoom:50%;" />

* 注释框为markdown控件，涉及到部分 **前端代码**（因为markdown本身不带注释框的自定义功能，但它支持html标签）





<img src="https://files.catbox.moe/7fux66.png" alt="12333" style="zoom:50%;" />

1. 标题：为居中的标签框

2. 注意：如果想要将标题放在打印后每页的标题，则在该标签框的属性中，选择 **分页符在前面插入** 

3. 表格：表格其实是markdown里面写的表格，参数的公式参考《四、(一)在md控件中显示字典的值》





<img src="https://files.catbox.moe/8ibtks.png" alt="1684307827104" style="zoom:50%;" />

* 实质为一个markdown控件，内容中使用公式对数据汇总参考《四、(二)在md控件中显示数据的汇总》





<img src="https://files.catbox.moe/9kgt8q.png" alt="1684308174482" style="zoom: 33%;" />

* 各个图形控件参考《五、图形控件》









![image-20230525105436929](https://files.catbox.moe/lnqkd7.png)
